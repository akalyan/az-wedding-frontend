box: wercker/nodejs

# Build definition
build:
  # The steps that will be executed on build
  steps:
    # A step that executes `npm install` command
    - npm-install

    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
          echo "bower version $(./node_modules/bower/bin/bower -v) running"

    - script:
        name: run bower install with verbose mode, clean first
        code: |
          ./node_modules/bower/bin/bower cache clean
          ./node_modules/bower/bin/bower install --verbose

    # - plasticine/bower-install@0.0.4

    # A step to run grunt with the default Gruntfile.js
    - grunt

deploy:
  steps:
    - grunt:
        tasks: archive

    - script:
        name: mkdir and move archive
        code: |
          mkdir arch
          mv archive.zip arch

    - s3sync:
        key_id: $AWS_KEY
        key_secret: $AWS_SECRET
        bucket_url: $S3_BUCKET_URL
        source_dir: arch/
