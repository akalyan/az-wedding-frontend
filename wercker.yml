box: wercker/nodejs

# Build definition
build:
  # The steps that will be executed on build
  steps:
    # A step that executes `npm install` command
    - npm-install

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

    - plasticine/bower-install@0.0.4

    # A step to run grunt with the default Gruntfile.js
    - grunt

deploy:
  steps:
    - grunt archive

    - script:
        name: mkdir and move archive
        code: |
          mkdir arch
          mv archive.tar arch

    - s3sync:
        key_id: $AWS_KEY
        key_secret: $AWS_SECRET
        bucket_url: $S3_BUCKET_URL
        source_dir: arch/

    - s3sync:
        key_id: $AWS_KEY
        key_secret: $AWS_SECRET
        bucket_url: $S3_BUCKET_URL
        source_dir: dist/
